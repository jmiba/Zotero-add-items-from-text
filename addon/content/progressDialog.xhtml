<?xml version="1.0"?>
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
<?xml-stylesheet href="chrome://zotero/skin/zotero.css" type="text/css"?>

<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
        xmlns:html="http://www.w3.org/1999/xhtml"
        id="add-items-progress-dialog"
        title="Processing..."
        width="450"
        height="140"
        persist="screenX screenY"
        onload="ProgressDialog.onLoad();">

<script type="application/javascript"><![CDATA[
var ProgressDialog = {
  io: null,
  
  onLoad: function() {
    this.io = window.arguments[0];
    
    // Set initial title and message
    if (this.io.dataIn) {
      if (this.io.dataIn.title) {
        document.title = this.io.dataIn.title;
      }
      if (this.io.dataIn.message) {
        document.getElementById('progress-message').textContent = this.io.dataIn.message;
      }
    }
    
    // Expose update method to parent
    window.updateProgress = this.updateProgress.bind(this);
    window.closeDialog = this.closeDialog.bind(this);
    window.showError = this.showError.bind(this);
  },
  
  updateProgress: function(message, percent) {
    var msgEl = document.getElementById('progress-message');
    var progressEl = document.getElementById('progress-bar');
    
    if (msgEl && message) {
      msgEl.textContent = message;
    }
    
    if (progressEl && typeof percent === 'number') {
      progressEl.value = percent;
      progressEl.max = 100;
      progressEl.removeAttribute('indeterminate');
    }
  },
  
  showError: function(title, message) {
    Services.prompt.alert(window, title, message);
  },
  
  closeDialog: function() {
    window.close();
  }
};
]]></script>

<vbox flex="1" style="padding: 20px;">
  <description id="progress-message" style="margin-bottom: 15px; font-size: 13px;">
    Processing...
  </description>
  
  <html:progress id="progress-bar" 
                 style="width: 100%; height: 20px;"
                 value="0"
                 max="100"></html:progress>
</vbox>

</window>
