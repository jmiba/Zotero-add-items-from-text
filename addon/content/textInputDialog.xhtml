<?xml version="1.0"?>
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
<?xml-stylesheet href="chrome://zotero/skin/zotero.css" type="text/css"?>

<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
        xmlns:html="http://www.w3.org/1999/xhtml"
        id="add-items-text-input-dialog"
        title="Add Items from Text"
        width="700"
        height="550"
        persist="screenX screenY width height"
        onload="TextInputDialog.onLoad();">

<script type="application/javascript"><![CDATA[
var TextInputDialog = {
  onLoad: function() {
    this.io = window.arguments[0];
    
    // Set description if provided
    if (this.io.dataIn && this.io.dataIn.description) {
      document.getElementById('description').textContent = this.io.dataIn.description;
    }
    
    // Set placeholder if provided
    if (this.io.dataIn && this.io.dataIn.placeholder) {
      document.getElementById('text-input').placeholder = this.io.dataIn.placeholder;
    }

    // Prefill previous text if provided
    if (this.io.dataIn && typeof this.io.dataIn.initialText === "string") {
      document.getElementById('text-input').value = this.io.dataIn.initialText;
    }
  },
  
  onAccept: function() {
    var text = document.getElementById('text-input').value;
    if (this.io) {
      this.io.dataOut = { text: text, confirmed: true };
    }
    window.close();
  },
  
  onCancel: function() {
    if (this.io) {
      this.io.dataOut = { text: null, confirmed: false };
    }
    window.close();
  }
};
]]></script>

<vbox flex="1" style="padding: 15px; overflow: hidden;">
  <description id="description" style="margin-bottom: 12px;">
    Paste text containing literature references below. The AI will extract and convert them to Zotero items.
  </description>
  
  <html:textarea id="text-input" 
                 style="width: 100%; box-sizing: border-box; flex: 1; min-height: 350px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace; font-size: 13px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; resize: none;"
                 placeholder="Paste your text with references here...

Example:
Smith, J. (2023). Machine Learning in Libraries. Journal of Information Science, 45(2), 123-145. https://doi.org/10.1234/jis.2023.001

Johnson, M. &amp; Williams, K. (2022). Digital Humanities and Library Science. Academic Press."></html:textarea>
  
  <hbox style="margin-top: 12px; justify-content: flex-end; gap: 10px;">
    <button id="cancel-button" label="Cancel" onmousedown="document.getElementById('text-input').blur();" oncommand="TextInputDialog.onCancel();"/>
    <button id="accept-button" label="Extract References" default="true" onmousedown="document.getElementById('text-input').blur();" oncommand="TextInputDialog.onAccept();"/>
  </hbox>
</vbox>

</window>
